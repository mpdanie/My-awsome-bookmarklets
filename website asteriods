javascript:(function()%7B%2F%2F See license%3A https%3A%2F%2Fgithub.com%2Ferkie%2Ferkie.github.com%2Fblob%2Fmaster%2FREADME%0A%0A(function() %7B%0Afunction Asteroids() %7B%0A%09if ( ! window.ASTEROIDS )%0A%09%09window.ASTEROIDS %3D %7B%0A%09%09%09enemiesKilled%3A 0%2C%0A%09%09%09startedPlaying%3A (new Date()).getTime()%0A%09%09%7D%3B%0A%0A%09var BASEPATH %3D 'http%3A%2F%2Fkickassapp.com%2F'%3B%0A%0A%09%2F*%0A%09%09Classes%0A%09*%2F%0A%0A%09function Vector(x%2C y) %7B%0A%09%09if ( typeof x %3D%3D 'Object' ) %7B%0A%09%09%09this.x %3D x.x%3B%0A%09%09%09this.y %3D x.y%3B%0A%09%09%7D else %7B%0A%09%09%09this.x %3D x%3B%0A%09%09%09this.y %3D y%3B%0A%09%09%7D%0A%09%7D%3B%0A%0A%09Vector.prototype %3D %7B%0A%09%09cp%3A function() %7B%0A%09%09%09return new Vector(this.x%2C this.y)%3B%0A%09%09%7D%2C%0A%0A%09%09mul%3A function(factor) %7B%0A%09%09%09this.x *%3D factor%3B%0A%09%09%09this.y *%3D factor%3B%0A%09%09%09return this%3B%0A%09%09%7D%2C%0A%0A%09%09mulNew%3A function(factor) %7B%0A%09%09%09return new Vector(this.x * factor%2C this.y * factor)%3B%0A%09%09%7D%2C%0A%0A%09%09add%3A function(vec) %7B%0A%09%09%09this.x %2B%3D vec.x%3B%0A%09%09%09this.y %2B%3D vec.y%3B%0A%09%09%09return this%3B%0A%09%09%7D%2C%0A%0A%09%09addNew%3A function(vec) %7B%0A%09%09%09return new Vector(this.x %2B vec.x%2C this.y %2B vec.y)%3B%0A%09%09%7D%2C%0A%0A%09%09sub%3A function(vec) %7B%0A%09%09%09this.x -%3D vec.x%3B%0A%09%09%09this.y -%3D vec.y%3B%0A%09%09%09return this%3B%0A%09%09%7D%2C%0A%0A%09%09subNew%3A function(vec) %7B%0A%09%09%09return new Vector(this.x - vec.x%2C this.y - vec.y)%3B%0A%09%09%7D%2C%0A%0A%09%09%2F%2F angle in radians%0A%09%09rotate%3A function(angle) %7B%0A%09%09%09var x %3D this.x%2C y %3D this.y%3B%0A%09%09%09this.x %3D x * Math.cos(angle) - Math.sin(angle) * y%3B%0A%09%09%09this.y %3D x * Math.sin(angle) %2B Math.cos(angle) * y%3B%0A%09%09%09return this%3B%0A%09%09%7D%2C%0A%0A%09%09%2F%2F angle still in radians%0A%09%09rotateNew%3A function(angle) %7B%0A%09%09%09return this.cp().rotate(angle)%3B%0A%09%09%7D%2C%0A%0A%09%09%2F%2F angle in radians... again%0A%09%09setAngle%3A function(angle) %7B%0A%09%09%09var l %3D this.len()%3B%0A%09%09%09this.x %3D Math.cos(angle) * l%3B%0A%09%09%09this.y %3D Math.sin(angle) * l%3B%0A%09%09%09return this%3B%0A%09%09%7D%2C%0A%0A%09%09%2F%2F RADIANS%0A%09%09setAngleNew%3A function(angle) %7B%0A%09%09%09return this.cp().setAngle(angle)%3B%0A%09%09%7D%2C%0A%0A%09%09setLength%3A function(length) %7B%0A%09%09%09var l %3D this.len()%3B%0A%09%09%09if ( l ) this.mul(length %2F l)%3B%0A%09%09%09else this.x %3D this.y %3D length%3B%0A%09%09%09return this%3B%0A%09%09%7D%2C%0A%0A%09%09setLengthNew%3A function(length) %7B%0A%09%09%09return this.cp().setLength(length)%3B%0A%09%09%7D%2C%0A%0A%09%09normalize%3A function() %7B%0A%09%09%09var l %3D this.len()%3B%0A%09%09%09this.x %2F%3D l%3B%0A%09%09%09this.y %2F%3D l%3B%0A%09%09%09return this%3B%0A%09%09%7D%2C%0A%0A%09%09normalizeNew%3A function() %7B%0A%09%09%09return this.cp().normalize()%3B%0A%09%09%7D%2C%0A%0A%09%09angle%3A function() %7B%0A%09%09%09return Math.atan2(this.y%2C this.x)%3B%0A%09%09%7D%2C%0A%0A%09%09collidesWith%3A function(rect) %7B%0A%09%09%09return this.x > rect.x %26%26 this.y > rect.y %26%26 this.x < rect.x %2B rect.width %26%26 this.y < rect.y %2B rect.height%3B%0A%09%09%7D%2C%0A%0A%09%09len%3A function() %7B%0A%09%09%09var l %3D Math.sqrt(this.x * this.x %2B this.y * this.y)%3B%0A%09%09%09if ( l < 0.005 %26%26 l > -0.005) return 0%3B%0A%09%09%09return l%3B%0A%09%09%7D%2C%0A%0A%09%09is%3A function(test) %7B%0A%0A%09%09%09return typeof test %3D%3D 'object' %26%26 this.x %3D%3D test.x %26%26 this.y %3D%3D test.y%3B%0A%09%09%7D%2C%0A%0A%09%09toString%3A function() %7B%0A%09%09%09return '%5BVector(' %2B this.x %2B '%2C ' %2B this.y %2B ') angle%3A ' %2B this.angle() %2B '%2C length%3A ' %2B this.len() %2B '%5D'%3B%0A%09%09%7D%0A%09%7D%3B%0A%0A%09function Line(p1%2C p2) %7B%0A%09%09this.p1 %3D p1%3B%0A%09%09this.p2 %3D p2%3B%0A%09%7D%3B%0A%0A%09Line.prototype %3D %7B%0A%09%09shift%3A function(pos) %7B%0A%09%09%09this.p1.add(pos)%3B%0A%09%09%09this.p2.add(pos)%3B%0A%09%09%7D%2C%0A%0A%09%09intersectsWithRect%3A function(rect) %7B%0A%09%09%09var LL %3D new Vector(rect.x%2C rect.y %2B rect.height)%3B%0A%09%09%09var UL %3D new Vector(rect.x%2C rect.y)%3B%0A%09%09%09var LR %3D new Vector(rect.x %2B rect.width%2C rect.y %2B rect.height)%3B%0A%09%09%09var UR %3D new Vector(rect.x %2B rect.width%2C rect.y)%3B%0A%0A%09%09%09if (%0A%09%09%09%09this.p1.x > LL.x %26%26 this.p1.x < UR.x %26%26 this.p1.y < LL.y %26%26 this.p1.y > UR.y %26%26%0A%09%09%09%09this.p2.x > LL.x %26%26 this.p2.x < UR.x %26%26 this.p2.y < LL.y %26%26 this.p2.y > UR.y%0A%09%09%09) return true%3B%0A%0A%09%09%09if ( this.intersectsLine(new Line(UL%2C LL)) ) return true%3B%0A%09%09%09if ( this.intersectsLine(new Line(LL%2C LR)) ) return true%3B%0A%09%09%09if ( this.intersectsLine(new Line(UL%2C UR)) ) return true%3B%0A%09%09%09if ( this.intersectsLine(new Line(UR%2C LR)) ) return true%3B%0A%09%09%09return false%3B%0A%09%09%7D%2C%0A%0A%09%09intersectsLine%3A function(line2) %7B%0A%09%09%09var v1 %3D this.p1%2C v2 %3D this.p2%3B%0A%09%09%09var v3 %3D line2.p1%2C v4 %3D line2.p2%3B%0A%0A%09%09%09var denom %3D ((v4.y - v3.y) * (v2.x - v1.x)) - ((v4.x - v3.x) * (v2.y - v1.y))%3B%0A%09%09%09var numerator %3D ((v4.x - v3.x) * (v1.y - v3.y)) - ((v4.y - v3.y) * (v1.x - v3.x))%3B%0A%0A%09%09%09var numerator2 %3D ((v2.x - v1.x) * (v1.y - v3.y)) - ((v2.y - v1.y) * (v1.x - v3.x))%3B%0A%0A%09%09%09if ( denom %3D%3D 0.0 ) %7B%0A%09%09%09%09return false%3B%0A%09%09%09%7D%0A%09%09%09var ua %3D numerator %2F denom%3B%0A%09%09%09var ub %3D numerator2 %2F denom%3B%0A%0A%09%09%09return (ua >%3D 0.0 %26%26 ua <%3D 1.0 %26%26 ub >%3D 0.0 %26%26 ub <%3D 1.0)%3B%0A%09%09%7D%0A%09%7D%3B%0A%0A%09function Highscores() %7B%0A%0A%09%7D%3B%0A%0A%09Highscores.prototype %3D %7B%0A%09  build%3A function() %7B%0A%09      var self %3D this%3B%0A%0A    %09%09var w %3D (document.clientWidth %7C%7C window.innerWidth %7C%7C document.documentElement.clientWidth)%3B%0A    %09%09var h %3D (document.clientHeight %7C%7C window.innerHeight %7C%7C document.documentElement.clientHeight)%3B%0A%0A    %09%09this.container %3D document.createElement('div')%3B%0A    %09%09this.container.className %3D "ASTEROIDSYEAH"%3B%0A    %09%09with ( this.container.style ) %7B%0A    %09%09%09position %3D "fixed"%3B%0A    %09%09%09top %3D parseInt(h %2F 2 - 250%2C 10) %2B "px"%3B%0A    %09%09%09left %3D parseInt(w %2F 2 - 250%2C 10) %2B "px"%3B%0A    %09%09%09width %3D "500px"%3B%0A    %09%09%09height %3D "500px"%3B%0A    %09%09%09boxShadow %3D MsBoxShadow %3D OBoxShadow %3D MozBoxShadow %3D WebkitBoxShadow %3D "0 0 25px %23000"%3B%0A    %09%09%09zIndex %3D "1000002"%3B%0A%09%09%09%09%2F%2FwebkitTransform causes a bug where you can't click anything in the iframe if the scroll is not top%0A    %09%09%09%2F%2FwebkitTransform %3D 'scale(0%2C 0)'%3B%0A    %09%09%09%2F%2FwebkitTransition %3D "-webkit-transform 500ms"%3B%0A    %09%09%09background %3D '%23222'%3B%0A    %09%09%7D%3B%0A    %09%09document.body.appendChild(this.container)%3B%0A%0A    %09%09%2F%2F Create iframe%0A    %09%09this.iframe %3D document.createElement('iframe')%3B%0A    %09%09this.iframe.className %3D "ASTEROIDSYEAH"%3B%0A    %09%09this.iframe.width %3D this.iframe.height %3D 500%3B%0A    %09%09this.iframe.frameBorder %3D 0%3B%0A    %09%09this.container.appendChild(this.iframe)%3B%0A%0A    %09%09%2F%2F Create close button%0A    %09%09this.close %3D document.createElement('a')%3B%0A    %09%09this.close.href %3D "%23"%3B%0A    %09%09this.close.onclick %3D function() %7B%0A    %09%09%09self.hide()%3B%0A    %09%09%09return false%3B%0A    %09%09%7D%3B%0A    %09%09this.close.innerHTML %3D "X"%3B%0A    %09%09with ( this.close.style ) %7B%0A    %09%09%09position %3D "absolute"%3B%0A    %09%09%09display %3D "block"%3B%0A    %09%09%09padding %3D "2px 6px"%3B%0A    %09%09%09top %3D "-12px"%3B%0A    %09%09%09right %3D "-12px"%3B%0A    %09%09%09background %3D "%23222"%3B%0A    %09%09%09%2F%2FtextIndent %3D "-10000px"%3B%0A    %09%09%09border %3D "3px solid %23fff"%3B%0A    %09%09%09boxShadow %3D "1px 1px 5px %23000"%3B%0A    %09%09%09color %3D "%23fff"%3B%0A    %09%09%09textAlign %3D "center"%3B%0A    %09%09%09borderRadius %3D "24px"%3B%0A    %09%09%09outline %3D "none"%3B%0A    %09%09%09textDecoration %3D "none"%3B%0A    %09%09%09fontFamily %3D "Verdana"%3B%0A    %09%09%09fontSize %3D "16px"%3B%0A    %09%09%09fontWeight %3D "bold"%3B%0A    %09%09%09zIndex %3D "10003"%3B%0A    %09%09%7D%0A    %09%09this.container.appendChild(this.close)%3B%0A    %09%09this.hide()%3B%0A%0A    %09%09document.body.appendChild(this.container)%3B%0A%09  %7D%2C%0A%0A%09%09show%3A function() %7B%0A%09%09  this.build()%3B%0A%09%09  this.container.style.display %3D 'block'%3B%0A%0A%09%09%09var self %3D this%3B%0A%09%09%09setTimeout(function() %7B%0A%09%09%09  %2F%2Fself.container.style.webkitTransform %3D 'scale(1%2C 1)'%3B%0A%09%09%09%7D%2C 50)%3B%0A%0A%09%09%09this.sendScore()%3B%0A%09%09%7D%2C%0A%0A%09%09hide%3A function() %7B%0A%09%09%09if ( this.container %26%26 this.container.parentNode )%0A%09%09%09%09this.container.parentNode.removeChild(this.container)%3B%0A%09%09%7D%2C%0A%0A%09%09sendScore%3A function() %7B%0A%09%09  var timePlayed %3D (new Date()).getTime() - window.ASTEROIDS.startedPlaying%3B%0A%09%09%09this.iframe.src %3D highscoreURL %2B "%3Fasd%3D" %2B (window.ASTEROIDS.enemiesKilled * 10).toString() %2B "%26sad%3D" %2B escape(document.location.href) %2B '%26das%3D' %2B timePlayed%3B%0A%09%09%7D%0A%09%7D%3B%0A%0A%09%2F*%0A%09%09end classes%2C begin code%0A%09*%2F%0A%0A%09var that %3D this%3B%0A%0A%09var isIE %3D !!window.ActiveXObject%3B %2F%2F IE gets less performance-intensive%0A%09var isIEQuirks %3D isIE %26%26 document.compatMode %3D%3D "BackCompat"%3B%0A%0A%09%2F%2F configuration directives are placed in local variables%0A%09var w %3D document.documentElement.clientWidth%2C h %3D document.documentElement.clientHeight%3B%0A%09if ( isIEQuirks ) %7B%0A%09%09w %3D document.body.clientWidth%3B%0A%09%09h %3D document.body.clientHeight%3B%0A%09%7D%0A%0A%09var playerWidth %3D 20%2C playerHeight %3D 30%3B%0A%0A%09var playerVerts %3D %5B%5B-1 * playerHeight%2F2%2C -1 * playerWidth%2F2%5D%2C %5B-1 * playerHeight%2F2%2C playerWidth%2F2%5D%2C %5BplayerHeight%2F2%2C 0%5D%5D%3B%0A%0A%09var ignoredTypes %3D %5B'HTML'%2C 'HEAD'%2C 'BODY'%2C 'SCRIPT'%2C 'TITLE'%2C 'META'%2C 'STYLE'%2C 'LINK'%5D%3B%0A%09if ( window.ActiveXObject )%0A%09%09ignoredTypes %3D %5B'HTML'%2C 'HEAD'%2C 'BODY'%2C 'SCRIPT'%2C 'TITLE'%2C 'META'%2C 'STYLE'%2C 'LINK'%2C 'SHAPE'%2C 'LINE'%2C 'GROUP'%2C 'IMAGE'%2C 'STROKE'%2C 'FILL'%2C 'SKEW'%2C 'PATH'%2C 'TEXTPATH'%2C 'INS'%5D%3B %2F%2F Half of these are for IE g_vml%0A%09var hiddenTypes %3D %5B'BR'%2C 'HR'%5D%3B%0A%0A%09var FPS %3D 50%3B%0A%0A%09%2F%2F units%2Fsecond%0A%09var acc%09%09%09  %3D 300%3B%0A%09var maxSpeed%09  %3D 600%3B%0A%09var rotSpeed%09  %3D 360%3B %2F%2F one rotation per second%0A%09var bulletSpeed%09  %3D 700%3B%0A%09var particleSpeed %3D 400%3B%0A%0A%09var timeBetweenFire %3D 150%3B %2F%2F how many milliseconds between shots%0A%09var timeBetweenBlink %3D 250%3B %2F%2F milliseconds between enemy blink%0A%09var timeBetweenEnemyUpdate %3D isIE %3F 10000 %3A 2000%3B%0A%09var bulletRadius %3D 2%3B%0A%09var maxParticles %3D isIE %3F 20 %3A 40%3B%0A%09var maxBullets %3D isIE %3F 10 %3A 20%3B%0A%0A%09var highscoreURL %3D BASEPATH %2B "highscores%2F"%3B%0A%0A%09%2F%2F generated every 10 ms%0A%09this.flame %3D %7Br%3A %5B%5D%2C y%3A %5B%5D%7D%3B%0A%0A%09%2F%2F blink style%0A%09this.toggleBlinkStyle %3D function () %7B%0A%09%09if (this.updated.blink.isActive) %7B%0A%09%09%09removeClass(document.body%2C 'ASTEROIDSBLINK')%3B%0A%09%09%7D else %7B%0A%09%09%09addClass(document.body%2C 'ASTEROIDSBLINK')%3B%0A%09%09%7D%0A%0A%09%09this.updated.blink.isActive %3D !this.updated.blink.isActive%3B%0A%09%7D%3B%0A%0A%09addStylesheet(".ASTEROIDSBLINK .ASTEROIDSYEAHENEMY"%2C "outline%3A 2px dotted red%3B")%3B%0A%0A%09this.pos %3D new Vector(100%2C 100)%3B%0A%09this.lastPos %3D false%3B%0A%09this.vel %3D new Vector(0%2C 0)%3B%0A%09this.dir %3D new Vector(0%2C 1)%3B%0A%09this.keysPressed %3D %7B%7D%3B%0A%09this.firedAt %3D false%3B%0A%09this.updated %3D %7B%0A%09%09enemies%3A false%2C %2F%2F if the enemy index has been updated since the user pressed B for Blink%0A%09%09flame%3A new Date().getTime()%2C %2F%2F the time the flame was last updated%0A%09%09blink%3A %7Btime%3A 0%2C isActive%3A false%7D%0A%09%7D%3B%0A%09this.scrollPos %3D new Vector(0%2C 0)%3B%0A%0A%09this.bullets %3D %5B%5D%3B%0A%0A%09%2F%2F Enemies lay first in this.enemies%2C when they are shot they are moved to this.dying%0A%09this.enemies %3D %5B%5D%3B%0A%09this.dying %3D %5B%5D%3B%0A%09this.totalEnemies %3D 0%3B%0A%0A%09%2F%2F Particles are created when something is shot%0A%09this.particles %3D %5B%5D%3B%0A%0A%09%2F%2F things to shoot is everything textual and an element of type not specified in types AND not a navigation element (see further down)%0A%09function updateEnemyIndex() %7B%0A%09%09for ( var i %3D 0%2C enemy%3B enemy %3D that.enemies%5Bi%5D%3B i%2B%2B )%0A%09%09%09removeClass(enemy%2C "ASTEROIDSYEAHENEMY")%3B%0A%0A%09%09var all %3D document.body.getElementsByTagName('*')%3B%0A%09%09that.enemies %3D %5B%5D%3B%0A%09%09for ( var i %3D 0%2C el%3B el %3D all%5Bi%5D%3B i%2B%2B ) %7B%0A%09%09%09%2F%2F elements with className ASTEROIDSYEAH are part of the "game"%0A%09%09%09if ( indexOf(ignoredTypes%2C el.tagName.toUpperCase()) %3D%3D -1 %26%26 el.prefix !%3D 'g_vml_' %26%26 hasOnlyTextualChildren(el) %26%26 el.className !%3D "ASTEROIDSYEAH" %26%26 el.offsetHeight > 0 ) %7B%0A%09%09%09%09el.aSize %3D size(el)%3B%0A%09%09%09%09that.enemies.push(el)%3B%0A%0A%09%09%09%09addClass(el%2C "ASTEROIDSYEAHENEMY")%3B%0A%0A%09%09%09%09%2F%2F this is only for enemycounting%0A%09%09%09%09if ( ! el.aAdded ) %7B%0A%09%09%09%09%09el.aAdded %3D true%3B%0A%09%09%09%09%09that.totalEnemies%2B%2B%3B%0A%09%09%09%09%7D%0A%09%09%09%7D%0A%09%09%7D%0A%09%7D%3B%0A%09updateEnemyIndex()%3B%0A%0A%09%2F%2F createFlames create the vectors for the flames of the ship%0A%09var createFlames%3B%0A%09(function () %7B%0A%09%09var rWidth %3D playerWidth%2C%0A%09%09%09rIncrease %3D playerWidth * 0.1%2C%0A%09%09%09yWidth %3D playerWidth * 0.6%2C%0A%09%09%09yIncrease %3D yWidth * 0.2%2C%0A%09%09%09halfR %3D rWidth %2F 2%2C%0A%09%09%09halfY %3D yWidth %2F 2%2C%0A%09%09%09halfPlayerHeight %3D playerHeight %2F 2%3B%0A%0A%09%09createFlames %3D function () %7B%0A%09%09%09%2F%2F Firstly create red flames%0A%09%09%09that.flame.r %3D %5B%5B-1 * halfPlayerHeight%2C -1 * halfR%5D%5D%3B%0A%09%09%09that.flame.y %3D %5B%5B-1 * halfPlayerHeight%2C -1 * halfY%5D%5D%3B%0A%0A%09%09%09for ( var x %3D 0%3B x < rWidth%3B x %2B%3D rIncrease ) %7B%0A%09%09%09%09that.flame.r.push(%5B-random(2%2C 7) - halfPlayerHeight%2C x - halfR%5D)%3B%0A%09%09%09%7D%0A%0A%09%09%09that.flame.r.push(%5B-1 * halfPlayerHeight%2C halfR%5D)%3B%0A%0A%09%09%09%2F%2F ... And now the yellow flames%0A%09%09%09for ( var x %3D 0%3B x < yWidth%3B x %2B%3D yIncrease ) %7B%0A%09%09%09%09that.flame.y.push(%5B-random(2%2C 7) - halfPlayerHeight%2C x - halfY%5D)%3B%0A%09%09%09%7D%0A%0A%09%09%09that.flame.y.push(%5B-1 * halfPlayerHeight%2C halfY%5D)%3B%0A%09%09%7D%3B%0A%09%7D)()%3B%0A%0A%09createFlames()%3B%0A%0A%09%2F*%0A%09%09Math operations%0A%09*%2F%0A%0A%09function radians(deg) %7B%0A%09%09return deg * 0.0174532925%3B%0A%09%7D%3B%0A%0A%09function degrees(rad) %7B%0A%09%09return rad * 57.2957795%3B%0A%09%7D%3B%0A%0A%09function random(from%2C to) %7B%0A%09%09return Math.floor(Math.random() * (to %2B 1) %2B from)%3B%0A%09%7D%3B%0A%0A%09%2F*%0A%09%09Misc operations%0A%09*%2F%0A%0A%09function code(name) %7B%0A%09%09var table %3D %7B'up'%3A 38%2C 'down'%3A 40%2C 'left'%3A 37%2C 'right'%3A 39%2C 'esc'%3A 27%7D%3B%0A%09%09if ( table%5Bname%5D ) return table%5Bname%5D%3B%0A%09%09return name.charCodeAt(0)%3B%0A%09%7D%3B%0A%0A%09function boundsCheck(vec) %7B%0A%09%09if ( vec.x > w )%0A%09%09%09vec.x %3D 0%3B%0A%09%09else if ( vec.x < 0 )%0A%09%09%09vec.x %3D w%3B%0A%0A%09%09if ( vec.y > h )%0A%09%09%09vec.y %3D 0%3B%0A%09%09else if ( vec.y < 0 )%0A%09%09%09vec.y %3D h%3B%0A%09%7D%3B%0A%0A%09function size(element) %7B%0A%09%09var el %3D element%2C left %3D 0%2C top %3D 0%3B%0A%09%09do %7B%0A%09%09%09left %2B%3D el.offsetLeft %7C%7C 0%3B%0A%09%09%09top %2B%3D el.offsetTop %7C%7C 0%3B%0A%09%09%09el %3D el.offsetParent%3B%0A%09%09%7D while (el)%3B%0A%09%09return %7Bx%3A left%2C y%3A top%2C width%3A element.offsetWidth %7C%7C 10%2C height%3A element.offsetHeight %7C%7C 10%7D%3B%0A%09%7D%3B%0A%0A%09%2F%2F Taken from%3A%0A%09%2F%2F http%3A%2F%2Fwww.quirksmode.org%2Fblog%2Farchives%2F2005%2F10%2F_and_the_winner_1.html%0A%09function addEvent( obj%2C type%2C fn ) %7B%0A%09%09if (obj.addEventListener)%0A%09%09%09obj.addEventListener( type%2C fn%2C false )%3B%0A%09%09else if (obj.attachEvent) %7B%0A%09%09%09obj%5B"e"%2Btype%2Bfn%5D %3D fn%3B%0A%09%09%09obj%5Btype%2Bfn%5D %3D function() %7B obj%5B"e"%2Btype%2Bfn%5D( window.event )%3B %7D%3B%0A%09%09%09obj.attachEvent( "on"%2Btype%2C obj%5Btype%2Bfn%5D )%3B%0A%09%09%7D%0A%09%7D%0A%0A%09function removeEvent( obj%2C type%2C fn ) %7B%0A%09%09if (obj.removeEventListener)%0A%09%09%09obj.removeEventListener( type%2C fn%2C false )%3B%0A%09%09else if (obj.detachEvent) %7B%0A%09%09%09obj.detachEvent( "on"%2Btype%2C obj%5Btype%2Bfn%5D )%3B%0A%09%09%09obj%5Btype%2Bfn%5D %3D null%3B%0A%09%09%09obj%5B"e"%2Btype%2Bfn%5D %3D null%3B%0A%09%09%7D%0A%09%7D%0A%0A%09function arrayRemove(array%2C from%2C to) %7B%0A%09%09var rest %3D array.slice((to %7C%7C from) %2B 1 %7C%7C array.length)%3B%0A%09%09array.length %3D from < 0 %3F array.length %2B from %3A from%3B%0A%09%09return array.push.apply(array%2C rest)%3B%0A%09%7D%3B%0A%0A%09function applyVisibility(vis) %7B%0A%09%09for ( var i %3D 0%2C p%3B p %3D window.ASTEROIDSPLAYERS%5Bi%5D%3B i%2B%2B ) %7B%0A%09%09%09p.gameContainer.style.visibility %3D vis%3B%0A%09%09%7D%0A%09%7D%0A%0A%09function getElementFromPoint(x%2C y) %7B%0A%09%09%2F%2F hide canvas so it isn't picked up%0A%09%09applyVisibility('hidden')%3B%0A%0A%09%09var element %3D document.elementFromPoint(x%2C y)%3B%0A%0A%09%09if ( ! element ) %7B%0A%09%09%09applyVisibility('visible')%3B%0A%09%09%09return false%3B%0A%09%09%7D%0A%0A%09%09if ( element.nodeType %3D%3D 3 )%0A%09%09%09element %3D element.parentNode%3B%0A%0A%09%09%2F%2F show the canvas again%2C hopefully it didn't blink%0A%09%09applyVisibility('visible')%3B%0A%09%09return element%3B%0A%09%7D%3B%0A%0A%09function addParticles(startPos) %7B%0A%09%09var time %3D new Date().getTime()%3B%0A%09%09var amount %3D maxParticles%3B%0A%09%09for ( var i %3D 0%3B i < amount%3B i%2B%2B ) %7B%0A%09%09%09that.particles.push(%7B%0A%09%09%09%09%2F%2F random direction%0A%09%09%09%09dir%3A (new Vector(Math.random() * 20 - 10%2C Math.random() * 20 - 10)).normalize()%2C%0A%09%09%09%09pos%3A startPos.cp()%2C%0A%09%09%09%09cameAlive%3A time%0A%09%09%09%7D)%3B%0A%09%09%7D%0A%09%7D%3B%0A%0A%09function setScore() %7B%0A%09%09that.points.innerHTML %3D window.ASTEROIDS.enemiesKilled * 10%3B%0A%09%7D%3B%0A%0A%09function hasOnlyTextualChildren(element) %7B%0A%09%09if ( element.offsetLeft < -100 %26%26 element.offsetWidth > 0 %26%26 element.offsetHeight > 0 ) return false%3B%0A%09%09if ( indexOf(hiddenTypes%2C element.tagName) !%3D -1 ) return true%3B%0A%0A%09%09if ( element.offsetWidth %3D%3D 0 %26%26 element.offsetHeight %3D%3D 0 ) return false%3B%0A%09%09for ( var i %3D 0%3B i < element.childNodes.length%3B i%2B%2B ) %7B%0A%09%09%09%2F%2F <br %2F> doesn't count... and empty elements%0A%09%09%09if (%0A%09%09%09%09indexOf(hiddenTypes%2C element.childNodes%5Bi%5D.tagName) %3D%3D -1%0A%09%09%09%09%26%26 element.childNodes%5Bi%5D.childNodes.length !%3D 0%0A%09%09%09) return false%3B%0A%09%09%7D%0A%09%09return true%3B%0A%09%7D%3B%0A%0A%09function indexOf(arr%2C item%2C from)%7B%0A%09%09if ( arr.indexOf ) return arr.indexOf(item%2C from)%3B%0A%09%09var len %3D arr.length%3B%0A%09%09for (var i %3D (from < 0) %3F Math.max(0%2C len %2B from) %3A from %7C%7C 0%3B i < len%3B i%2B%2B)%7B%0A%09%09%09if (arr%5Bi%5D %3D%3D%3D item) return i%3B%0A%09%09%7D%0A%09%09return -1%3B%0A%09%7D%3B%0A%0A%09%2F%2F taken from MooTools Core%0A%09function addClass(element%2C className) %7B%0A%09%09if ( element %26%26 element.className %26%26 element.className.indexOf %26%26 element.className.indexOf(className) %3D%3D -1)%0A%09%09%09element.className %3D (element.className %2B ' ' %2B className).replace(%2F%5Cs%2B%2Fg%2C ' ').replace(%2F%5E%5Cs%2B%7C%5Cs%2B%24%2Fg%2C '')%3B%0A%09%7D%3B%0A%0A%09%2F%2F taken from MooTools Core%0A%09function removeClass(element%2C className) %7B%0A%09%09element.className %3D element.className.replace(new RegExp('(%5E%7C%5C%5Cs)' %2B className %2B '(%3F%3A%5C%5Cs%7C%24)')%2C '%241')%3B%0A%09%7D%3B%0A%0A%09function addStylesheet(selector%2C rules) %7B%0A%09%09var stylesheet %3D document.createElement('style')%3B%0A%09%09stylesheet.type %3D 'text%2Fcss'%3B%0A%09%09stylesheet.rel %3D 'stylesheet'%3B%0A%09%09stylesheet.id %3D 'ASTEROIDSYEAHSTYLES'%3B%0A%09%09try %7B%0A%09%09%09stylesheet.innerHTML %3D selector %2B "%7B" %2B rules %2B "%7D"%3B%0A%09%09%7D catch ( e ) %7B%0A%09%09%09stylesheet.styleSheet.addRule(selector%2C rules)%3B%0A%09%09%7D%0A%09%09document.getElementsByTagName("head")%5B0%5D.appendChild(stylesheet)%3B%0A%09%7D%3B%0A%0A%09function removeStylesheet(name) %7B%0A%09%09var stylesheet %3D document.getElementById(name)%3B%0A%09%09if ( stylesheet ) %7B%0A%09%09%09stylesheet.parentNode.removeChild(stylesheet)%3B%0A%09%09%7D%0A%09%7D%3B%0A%0A%09%2F*%0A%09%09%3D%3D Setup %3D%3D%0A%09*%2F%0A%09this.gameContainer %3D document.createElement('div')%3B%0A%09this.gameContainer.className %3D 'ASTEROIDSYEAH'%3B%0A%09document.body.appendChild(this.gameContainer)%3B%0A%0A%09this.canvas %3D document.createElement('canvas')%3B%0A%09this.canvas.setAttribute('width'%2C w)%3B%0A%09this.canvas.setAttribute('height'%2C h)%3B%0A%09this.canvas.className %3D 'ASTEROIDSYEAH'%3B%0A%09with ( this.canvas.style ) %7B%0A%09%09width %3D w %2B "px"%3B%0A%09%09height %3D h %2B "px"%3B%0A%09%09position %3D "fixed"%3B%0A%09%09top %3D "0px"%3B%0A%09%09left %3D "0px"%3B%0A%09%09bottom %3D "0px"%3B%0A%09%09right %3D "0px"%3B%0A%09%09zIndex %3D "10000"%3B%0A%09%7D%0A%0A%09%2F%2F Is IE%0A%09if ( typeof G_vmlCanvasManager !%3D 'undefined' ) %7B%0A%09%09this.canvas %3D G_vmlCanvasManager.initElement(this.canvas)%3B%0A%09%09if ( ! this.canvas.getContext ) %7B%0A%09%09%09alert("So... you're using IE%3F  Please join me at http%3A%2F%2Fgithub.com%2Ferkie%2Ferkie.github.com if you think you can help")%3B%0A%09%09%7D%0A%09%7D else %7B%0A%09%09if ( ! this.canvas.getContext ) %7B%0A%09%09%09alert('This program does not yet support your browser. Please join me at http%3A%2F%2Fgithub.com%2Ferkie%2Ferkie.github.com if you think you can help')%3B%0A%09%09%7D%0A%09%7D%0A%0A%09addEvent(this.canvas%2C 'mousedown'%2C function(e) %7B%0A%09%09e %3D e %7C%7C window.event%3B%0A%09%09var message %3D document.createElement('span')%3B%0A%09%09message.style.position %3D 'absolute'%3B%0A%09%09message.style.border %3D '1px solid %23999'%3B%0A%09%09message.style.background %3D 'white'%3B%0A%09%09message.style.color %3D "black"%3B%0A%09%09message.innerHTML %3D 'Press Esc to quit'%3B%0A%09%09document.body.appendChild(message)%3B%0A%0A%09%09var x %3D e.pageX %7C%7C (e.clientX %2B document.documentElement.scrollLeft)%3B%0A%09%09var y %3D e.pageY %7C%7C (e.clientY %2B document.documentElement.scrollTop)%3B%0A%09%09message.style.left %3D x - message.offsetWidth%2F2 %2B 'px'%3B%0A%09%09message.style.top %3D y - message.offsetHeight%2F2 %2B 'px'%3B%0A%0A%09%09setTimeout(function() %7B%0A%09%09%09try %7B%0A%09%09%09%09message.parentNode.removeChild(message)%3B%0A%09%09%09%7D catch ( e ) %7B%7D%0A%09%09%7D%2C 1000)%3B%0A%09%7D)%3B%0A%0A%09var eventResize %3D function() %7B%0A%09%09if ( ! isIE ) %7B%0A%09%09%09that.canvas.style.display %3D "none"%3B%0A%0A%09%09%09w %3D document.documentElement.clientWidth%3B%0A%09%09%09h %3D document.documentElement.clientHeight%3B%0A%0A%09%09%09that.canvas.setAttribute('width'%2C w)%3B%0A%09%09%09that.canvas.setAttribute('height'%2C h)%3B%0A%0A%09%09%09with ( that.canvas.style ) %7B%0A%09%09%09%09display %3D "block"%3B%0A%09%09%09%09width %3D w %2B "px"%3B%0A%09%09%09%09height %3D h %2B "px"%3B%0A%09%09%09%7D%0A%09%09%7D else %7B%0A%09%09%09w %3D document.documentElement.clientWidth%3B%0A%09%09%09h %3D document.documentElement.clientHeight%3B%0A%0A%09%09%09if ( isIEQuirks ) %7B%0A%09%09%09%09w %3D document.body.clientWidth%3B%0A%09%09%09%09h %3D document.body.clientHeight%3B%0A%09%09%09%7D%0A%0A%09%09%09that.canvas.setAttribute('width'%2C w)%3B%0A%09%09%09that.canvas.setAttribute('height'%2C h)%3B%0A%09%09%7D%0A%09%09forceChange %3D true%3B%0A%09%7D%3B%0A%09addEvent(window%2C 'resize'%2C eventResize)%3B%0A%0A%09this.gameContainer.appendChild(this.canvas)%3B%0A%09this.ctx %3D this.canvas.getContext("2d")%3B%0A%0A%09this.ctx.fillStyle %3D "black"%3B%0A%09this.ctx.strokeStyle %3D "black"%3B%0A%0A%09%2F%2F navigation wrapper element%0A%09if ( ! document.getElementById('ASTEROIDS-NAVIGATION') ) %7B%0A%09%09this.navigation %3D document.createElement('div')%3B%0A%09%09this.navigation.id %3D "ASTEROIDS-NAVIGATION"%3B%0A%09%09this.navigation.className %3D "ASTEROIDSYEAH"%3B%0A%09%09with ( this.navigation.style ) %7B%0A%09%09%09fontFamily %3D "Arial%2Csans-serif"%3B%0A%09%09%09position %3D "fixed"%3B%0A%09%09%09zIndex %3D "10001"%3B%0A%09%09%09bottom %3D "0px"%3B%0A%09%09%09right %3D "10px"%3B%0A%09%09%09textAlign %3D "left"%3B%0A%09%09%09background %3D '%23fff'%3B%0A%09%09%09color %3D '%23222'%3B%0A%09%09%09padding %3D '2px'%3B%0A%09%09%09border %3D '1px solid %23e1e1e1'%3B%0A%09%09%09boxShadow %3D '-2px -2px 15px %23333'%3B%0A%09%09%09borderRadius %3D "3px"%3B%0A%09%09%7D%0A%09%09%2F%2F this.gameContainer.appendChild(this.navigation)%3B%0A%0A%09%09%2F%2F points%0A%09%09this.points %3D document.createElement('span')%3B%0A%09%09this.points.id %3D 'ASTEROIDS-POINTS'%3B%0A%09%09with ( this.points.style ) %7B%0A%09%09%09font %3D '28pt Arial%2C sans-serif'%3B%0A%09%09%09fontWeight %3D 'bold'%3B%0A%09%09%09position %3D 'relative'%3B%0A%09%09%09left %3D '20px'%3B%0A%09%09%7D%0A%09%09this.points.className %3D "ASTEROIDSYEAH"%3B%0A%09%09this.navigation.appendChild(this.points)%3B%0A%0A%09%09%2F%2F highscore link%0A%09%09this.highscoreLink %3D document.createElement('a')%3B%0A%09%09this.highscoreLink.className %3D "ASTEROIDSYEAH"%3B%0A%09%09var css %3D %7B%0A%09%09%09fontFamily%3A 'Arial'%2C%0A%09%09%09fontSize%3A '15px'%2C%0A%09%09%09fontWeight%3A 'normal'%2C%0A%09%09%09color%3A '%23fff'%2C%0A%09%09%09background%3A '%23333'%2C%0A%09%09%09textDecoration%3A 'none'%2C%0A%09%09%09display%3A 'inline'%2C%0A%09%09%09padding%3A '2px'%2C%0A%09%09%09borderRadius%3A '5px'%2C%0A%09%09%09position%3A 'relative'%2C%0A%09%09%09left%3A '30px'%2C%0A%09%09%09top%3A '-3px'%0A%09%09%7D%0A%0A%09%09for ( var key in css ) if ( css.hasOwnProperty(key) )%0A%09%09  this.highscoreLink.style%5Bkey%5D %3D css%5Bkey%5D%3B%0A%0A%09%09this.highscoreLink.href %3D '%23'%3B%0A%09%09this.highscoreLink.innerHTML %3D "Submit highscore"%3B%0A%09%09%2F%2F this.navigation.appendChild(this.highscoreLink)%3B%0A%0A%0A%09%09%2F%2F credits for kickass%0A%09%09this.credits %3D document.createElement('div')%3B%0A%09%09this.credits.innerHTML %3D '<div style%3D"padding%3A 15px 20px 0"><span style%3D"color%3A red%3B font-size%3A 150%25">â™¥<%2Fspan> this asteroids game%3F <br><span style%3D"margin-top%3A 10px%3B font-size%3A smaller%3B color%3A %23666">It%5C's made by the awesome folks of <a target%3D"_blank" href%3D"http%3A%2F%2Fkickassapp.com">KICK ASS<%2Fa> App. <br>Checkout their game in the <a href%3D"http%3A%2F%2Fitunes.apple.com%2Fus%2Fapp%2Fkick-ass-destroy-the-web%2Fid436623109%3Fmt%3D8" target%3D"_blank">App Store<%2Fa>.<%2Fspan><%2Fdiv>'%3B%0A%09%09this.navigation.appendChild(this.credits)%3B%0A%0A%09%09this.highscoreLink.onclick %3D function() %7B%0A%09%09%09if ( ! that.highscores ) %7B%0A%09%09%09%09that.highscores %3D new Highscores()%3B%0A%09%09%09%7D%0A%0A%09%09  that.highscores.show()%3B%0A%09%09%09return false%3B%0A%09%09%7D%3B%0A%09%7D else %7B%0A%09%09this.navigation %3D document.getElementById('ASTEROIDS-NAVIGATION')%3B%0A%09%09this.points %3D document.getElementById('ASTEROIDS-POINTS')%3B%0A%09%7D%0A%0A%09%2F%2F Because IE quirks does not understand position%3A fixed we set to absolute and just reposition it everything frame%0A%09if ( isIEQuirks ) %7B%0A%09%09this.gameContainer.style.position %3D%0A%09%09%09this.canvas.style.position %3D%0A%09%09%09this.navigation.style.position%0A%09%09%09%09%3D "absolute"%3B%0A%09%7D%0A%0A%09setScore()%3B%0A%09%2F%2F For ie%0A%09if ( typeof G_vmlCanvasManager !%3D 'undefined' ) %7B%0A%09%09var children %3D this.canvas.getElementsByTagName('*')%3B%0A%09%09for ( var i %3D 0%2C c%3B c %3D children%5Bi%5D%3B i%2B%2B )%0A%09%09%09addClass(c%2C 'ASTEROIDSYEAH')%3B%0A%09%7D%0A%0A%09%2F*%0A%09%09%3D%3D Events %3D%3D%0A%09*%2F%0A%0A%09var eventKeydown %3D function(event) %7B%0A%09%09event %3D event %7C%7C window.event%3B%0A%09%09if ( event.ctrlKey %7C%7C event.shiftKey )%0A%09%09%09return%3B%0A%09%09that.keysPressed%5Bevent.keyCode%5D %3D true%3B%0A%0A%09%09switch ( event.keyCode ) %7B%0A%09%09%09case code(' ')%3A%0A%09%09%09%09that.firedAt %3D 1%3B%0A%09%09%09break%3B%0A%09%09%7D%0A%0A%09%09%2F%2F check here so we can stop propagation appropriately%0A%09%09if ( indexOf(%5Bcode('up')%2C code('down')%2C code('right')%2C code('left')%2C code(' ')%2C code('B')%2C code('W')%2C code('A')%2C code('S')%2C code('D')%5D%2C event.keyCode) !%3D -1 ) %7B%0A%09%09%09if ( event.ctrlKey %7C%7C event.shiftKey )%0A%09%09%09%09return%3B%0A%0A%09%09%09if ( event.preventDefault )%0A%09%09%09%09event.preventDefault()%3B%0A%09%09%09if ( event.stopPropagation)%0A%09%09%09%09event.stopPropagation()%3B%0A%09%09%09event.returnValue %3D false%3B%0A%09%09%09event.cancelBubble %3D true%3B%0A%09%09%09return false%3B%0A%09%09%7D%0A%09%7D%3B%0A%09addEvent(document%2C 'keydown'%2C eventKeydown)%3B%0A%0A%09var eventKeypress %3D function(event) %7B%0A%09%09event %3D event %7C%7C window.event%3B%0A%09%09if ( indexOf(%5Bcode('up')%2C code('down')%2C code('right')%2C code('left')%2C code(' ')%2C code('W')%2C code('A')%2C code('S')%2C code('D')%5D%2C event.keyCode %7C%7C event.which) !%3D -1 ) %7B%0A%09%09%09if ( event.ctrlKey %7C%7C event.shiftKey )%0A%09%09%09%09return%3B%0A%0A%09%09%09if ( event.preventDefault )%0A%09%09%09%09event.preventDefault()%3B%0A%09%09%09if ( event.stopPropagation )%0A%09%09%09%09event.stopPropagation()%3B%0A%09%09%09event.returnValue %3D false%3B%0A%09%09%09event.cancelBubble %3D true%3B%0A%09%09%09return false%3B%0A%09%09%7D%0A%09%7D%3B%0A%09addEvent(document%2C 'keypress'%2C eventKeypress)%3B%0A%0A%09var eventKeyup %3D function(event) %7B%0A%09%09event %3D event %7C%7C window.event%3B%0A%09%09that.keysPressed%5Bevent.keyCode%5D %3D false%3B%0A%0A%09%09if ( indexOf(%5Bcode('up')%2C code('down')%2C code('right')%2C code('left')%2C code(' ')%2C code('B')%2C code('W')%2C code('A')%2C code('S')%2C code('D')%5D%2C event.keyCode) !%3D -1 ) %7B%0A%09%09%09if ( event.preventDefault )%0A%09%09%09%09event.preventDefault()%3B%0A%09%09%09if ( event.stopPropagation )%0A%09%09%09%09event.stopPropagation()%3B%0A%09%09%09event.returnValue %3D false%3B%0A%09%09%09event.cancelBubble %3D true%3B%0A%09%09%09return false%3B%0A%09%09%7D%0A%09%7D%3B%0A%09addEvent(document%2C 'keyup'%2C eventKeyup)%3B%0A%0A%09%2F*%0A%09%09Context operations%0A%09*%2F%0A%0A%09this.ctx.clear %3D function() %7B%0A%09%09this.clearRect(0%2C 0%2C w%2C h)%3B%0A%09%7D%3B%0A%0A%09this.ctx.clear()%3B%0A%0A%09this.ctx.drawLine %3D function(xFrom%2C yFrom%2C xTo%2C yTo) %7B%0A%09%09this.beginPath()%3B%0A%09%09this.moveTo(xFrom%2C yFrom)%3B%0A%09%09this.lineTo(xTo%2C yTo)%3B%0A%09%09this.lineTo(xTo %2B 1%2C yTo %2B 1)%3B%0A%09%09this.closePath()%3B%0A%09%09this.fill()%3B%0A%09%7D%3B%0A%0A%09this.ctx.tracePoly %3D function(verts) %7B%0A%09%09this.beginPath()%3B%0A%09%09this.moveTo(verts%5B0%5D%5B0%5D%2C verts%5B0%5D%5B1%5D)%3B%0A%09%09for ( var i %3D 1%3B i < verts.length%3B i%2B%2B )%0A%09%09%09this.lineTo(verts%5Bi%5D%5B0%5D%2C verts%5Bi%5D%5B1%5D)%3B%0A%09%09this.closePath()%3B%0A%09%7D%3B%0A%0A%09var THEPLAYER %3D false%3B%0A%09if ( window.KICKASSIMG ) %7B%0A%09%09THEPLAYER %3D document.createElement('img')%3B%0A%09%09THEPLAYER.src %3D window.KICKASSIMG%3B%0A%09%7D%0A%0A%09this.ctx.drawPlayer %3D function() %7B%0A%09%09if ( ! THEPLAYER ) %7B%0A%09%09%09this.save()%3B%0A%09%09%09this.translate(that.pos.x%2C that.pos.y)%3B%0A%09%09%09this.rotate(that.dir.angle())%3B%0A%09%09%09this.tracePoly(playerVerts)%3B%0A%09%09%09this.fillStyle %3D "white"%3B%0A%09%09%09this.fill()%3B%0A%09%09%09this.tracePoly(playerVerts)%3B%0A%09%09%09this.stroke()%3B%0A%09%09%09this.restore()%3B%0A%09%09%7D else %7B%0A%09%09%09this.save()%3B%0A%09%09%09this.translate(that.pos.x%2C that.pos.y)%3B%0A%09%09%09this.rotate(that.dir.angle()%2BMath.PI%2F2)%3B%0A%09%09%09this.drawImage(THEPLAYER%2C -THEPLAYER.width%2F2%2C -THEPLAYER.height%2F2)%3B%0A%09%09%09this.restore()%3B%0A%09%09%7D%0A%09%7D%3B%0A%0A%09var PI_SQ %3D Math.PI*2%3B%0A%0A%09this.ctx.drawBullets %3D function(bullets) %7B%0A%09%09for ( var i %3D 0%3B i < bullets.length%3B i%2B%2B ) %7B%0A%09%09%09this.beginPath()%3B%0A%09%09%09this.arc(bullets%5Bi%5D.pos.x%2C bullets%5Bi%5D.pos.y%2C bulletRadius%2C 0%2C PI_SQ%2C true)%3B%0A%09%09%09this.closePath()%3B%0A%09%09%09this.fill()%3B%0A%09%09%7D%0A%09%7D%3B%0A%0A%09var randomParticleColor %3D function() %7B%0A%09%09return (%5B'red'%2C 'yellow'%5D)%5Brandom(0%2C 1)%5D%3B%0A%09%7D%3B%0A%0A%09this.ctx.drawParticles %3D function(particles) %7B%0A%09%09var oldColor %3D this.fillStyle%3B%0A%0A%09%09for ( var i %3D 0%3B i < particles.length%3B i%2B%2B ) %7B%0A%09%09%09this.fillStyle %3D randomParticleColor()%3B%0A%09%09%09this.drawLine(particles%5Bi%5D.pos.x%2C particles%5Bi%5D.pos.y%2C particles%5Bi%5D.pos.x - particles%5Bi%5D.dir.x * 10%2C particles%5Bi%5D.pos.y - particles%5Bi%5D.dir.y * 10)%3B%0A%09%09%7D%0A%0A%09%09this.fillStyle %3D oldColor%3B%0A%09%7D%3B%0A%0A%09this.ctx.drawFlames %3D function(flame) %7B%0A%09%09if ( THEPLAYER ) return%3B%0A%0A%09%09this.save()%3B%0A%0A%09%09this.translate(that.pos.x%2C that.pos.y)%3B%0A%09%09this.rotate(that.dir.angle())%3B%0A%0A%09%09var oldColor %3D this.strokeStyle%3B%0A%09%09this.strokeStyle %3D "red"%3B%0A%09%09this.tracePoly(flame.r)%3B%0A%09%09this.stroke()%3B%0A%0A%09%09this.strokeStyle %3D "yellow"%3B%0A%09%09this.tracePoly(flame.y)%3B%0A%09%09this.stroke()%3B%0A%0A%09%09this.strokeStyle %3D oldColor%3B%0A%09%09this.restore()%3B%0A%09%7D%3B%0A%0A%09%2F*%0A%09%09Game loop%0A%09*%2F%0A%0A%09%2F%2F Attempt to focus window if possible%2C so keyboard events are posted to us%0A%09try %7B%0A%09%09window.focus()%3B%0A%09%7D catch ( e ) %7B%7D%0A%0A%09addParticles(this.pos)%3B%0A%09addClass(document.body%2C 'ASTEROIDSYEAH')%3B%0A%0A%09var isRunning %3D true%3B%0A%09var lastUpdate %3D new Date().getTime()%3B%0A%09var forceChange %3D false%3B%0A%0A%09this.update %3D function() %7B%0A%09%09%2F%2F %3D%3D%0A%09%09%2F%2F logic%0A%09%09%2F%2F %3D%3D%0A%09%09var nowTime %3D new Date().getTime()%3B%0A%09%09var tDelta %3D (nowTime - lastUpdate) %2F 1000%3B%0A%09%09lastUpdate %3D nowTime%3B%0A%0A%09%09%2F%2F update flame and timer if needed%0A%09%09var drawFlame %3D false%3B%0A%09%09if ( nowTime - this.updated.flame > 50 ) %7B%0A%09%09%09createFlames()%3B%0A%09%09%09this.updated.flame %3D nowTime%3B%0A%09%09%7D%0A%0A%09%09this.scrollPos.x %3D window.pageXOffset %7C%7C document.documentElement.scrollLeft%3B%0A%09%09this.scrollPos.y %3D window.pageYOffset %7C%7C document.documentElement.scrollTop%3B%0A%0A%09%09%2F%2F update player%0A%09%09%2F%2F move forward%0A%09%09if ( (this.keysPressed%5Bcode('up')%5D) %7C%7C (this.keysPressed%5Bcode('W')%5D) ) %7B%0A%09%09%09this.vel.add(this.dir.mulNew(acc * tDelta))%3B%0A%0A%09%09%09drawFlame %3D true%3B%0A%09%09%7D else %7B%0A%09%09%09%2F%2F decrease speed of player%0A%09%09%09this.vel.mul(0.96)%3B%0A%09%09%7D%0A%0A%09%09%2F%2F rotate counter-clockwise%0A%09%09if ( (this.keysPressed%5Bcode('left')%5D) %7C%7C (this.keysPressed%5Bcode('A')%5D) ) %7B%0A%09%09%09forceChange %3D true%3B%0A%09%09%09this.dir.rotate(radians(rotSpeed * tDelta * -1))%3B%0A%09%09%7D%0A%0A%09%09%2F%2F rotate clockwise%0A%09%09if ( (this.keysPressed%5Bcode('right')%5D) %7C%7C (this.keysPressed%5Bcode('D')%5D) ) %7B%0A%09%09%09forceChange %3D true%3B%0A%09%09%09this.dir.rotate(radians(rotSpeed * tDelta))%3B%0A%09%09%7D%0A%0A%09%09%2F%2F fire%0A%09%09if ( this.keysPressed%5Bcode(' ')%5D %26%26 nowTime - this.firedAt > timeBetweenFire ) %7B%0A%09%09%09this.bullets.unshift(%7B%0A%09%09%09%09'dir'%3A this.dir.cp()%2C%0A%09%09%09%09'pos'%3A this.pos.cp()%2C%0A%09%09%09%09'startVel'%3A this.vel.cp()%2C%0A%09%09%09%09'cameAlive'%3A nowTime%0A%09%09%09%7D)%3B%0A%0A%09%09%09this.firedAt %3D nowTime%3B%0A%0A%09%09%09if ( this.bullets.length > maxBullets ) %7B%0A%09%09%09%09this.bullets.pop()%3B%0A%09%09%09%7D%0A%09%09%7D%0A%0A%09%09%2F%2F add blink%0A%09%09if ( this.keysPressed%5Bcode('B')%5D ) %7B%0A%09%09%09if ( ! this.updated.enemies ) %7B%0A%09%09%09%09updateEnemyIndex()%3B%0A%09%09%09%09this.updated.enemies %3D true%3B%0A%09%09%09%7D%0A%0A%09%09%09forceChange %3D true%3B%0A%0A%09%09%09this.updated.blink.time %2B%3D tDelta * 1000%3B%0A%09%09%09if ( this.updated.blink.time > timeBetweenBlink ) %7B%0A%09%09%09%09this.toggleBlinkStyle()%3B%0A%09%09%09%09this.updated.blink.time %3D 0%3B%0A%09%09%09%7D%0A%09%09%7D else %7B%0A%09%09%09this.updated.enemies %3D false%3B%0A%09%09%7D%0A%0A%09%09if ( this.keysPressed%5Bcode('esc')%5D ) %7B%0A%09%09%09destroy.apply(this)%3B%0A%09%09%09return%3B%0A%09%09%7D%0A%0A%09%09%2F%2F cap speed%0A%09%09if ( this.vel.len() > maxSpeed ) %7B%0A%09%09%09this.vel.setLength(maxSpeed)%3B%0A%09%09%7D%0A%0A%09%09%2F%2F add velocity to player (physics)%0A%09%09this.pos.add(this.vel.mulNew(tDelta))%3B%0A%0A%09%09%2F%2F check bounds X of player%2C if we go outside we scroll accordingly%0A%09%09if ( this.pos.x > w ) %7B%0A%09%09%09window.scrollTo(this.scrollPos.x %2B 50%2C this.scrollPos.y)%3B%0A%09%09%09this.pos.x %3D 0%3B%0A%09%09%7D else if ( this.pos.x < 0 ) %7B%0A%09%09%09window.scrollTo(this.scrollPos.x - 50%2C this.scrollPos.y)%3B%0A%09%09%09this.pos.x %3D w%3B%0A%09%09%7D%0A%0A%09%09%2F%2F check bounds Y%0A%09%09if ( this.pos.y > h ) %7B%0A%09%09%09window.scrollTo(this.scrollPos.x%2C this.scrollPos.y %2B h * 0.75)%3B%0A%09%09%09this.pos.y %3D 0%3B%0A%09%09%7D else if ( this.pos.y < 0 ) %7B%0A%09%09%09window.scrollTo(this.scrollPos.x%2C this.scrollPos.y - h * 0.75)%3B%0A%09%09%09this.pos.y %3D h%3B%0A%09%09%7D%0A%0A%09%09%2F%2F update positions of bullets%0A%09%09for ( var i %3D this.bullets.length - 1%3B i >%3D 0%3B i-- ) %7B%0A%09%09%09%2F%2F bullets should only live for 2 seconds%0A%09%09%09if ( nowTime - this.bullets%5Bi%5D.cameAlive > 2000 ) %7B%0A%09%09%09%09this.bullets.splice(i%2C 1)%3B%0A%09%09%09%09forceChange %3D true%3B%0A%09%09%09%09continue%3B%0A%09%09%09%7D%0A%0A%09%09%09var bulletVel %3D this.bullets%5Bi%5D.dir.setLengthNew(bulletSpeed * tDelta).add(this.bullets%5Bi%5D.startVel.mulNew(tDelta))%3B%0A%0A%09%09%09this.bullets%5Bi%5D.pos.add(bulletVel)%3B%0A%09%09%09boundsCheck(this.bullets%5Bi%5D.pos)%3B%0A%0A%09%09%09%2F%2F check collisions%0A%09%09%09var murdered %3D getElementFromPoint(this.bullets%5Bi%5D.pos.x%2C this.bullets%5Bi%5D.pos.y)%3B%0A%09%09%09if (%0A%09%09%09%09murdered %26%26 murdered.tagName %26%26%0A%09%09%09%09indexOf(ignoredTypes%2C murdered.tagName.toUpperCase()) %3D%3D -1 %26%26%0A%09%09%09%09hasOnlyTextualChildren(murdered) %26%26 murdered.className !%3D "ASTEROIDSYEAH"%0A%09%09%09) %7B%0A%09%09%09%09didKill %3D true%3B%0A%09%09%09%09addParticles(this.bullets%5Bi%5D.pos)%3B%0A%09%09%09%09this.dying.push(murdered)%3B%0A%0A%09%09%09%09this.bullets.splice(i%2C 1)%3B%0A%09%09%09%09continue%3B%0A%09%09%09%7D%0A%09%09%7D%0A%0A%09%09if (this.dying.length) %7B%0A%09%09%09for ( var i %3D this.dying.length - 1%3B i >%3D 0%3B i-- ) %7B%0A%09%09%09%09try %7B%0A%09%09%09%09%09%2F%2F If we have multiple spaceships it might have already been removed%0A%09%09%09%09%09if ( this.dying%5Bi%5D.parentNode )%0A%09%09%09%09%09%09window.ASTEROIDS.enemiesKilled%2B%2B%3B%0A%0A%09%09%09%09%09this.dying%5Bi%5D.parentNode.removeChild(this.dying%5Bi%5D)%3B%0A%09%09%09%09%7D catch ( e ) %7B%7D%0A%09%09%09%7D%0A%0A%09%09%09setScore()%3B%0A%09%09%09this.dying %3D %5B%5D%3B%0A%09%09%7D%0A%0A%09%09%2F%2F update particles position%0A%09%09for ( var i %3D this.particles.length - 1%3B i >%3D 0%3B i-- ) %7B%0A%09%09%09this.particles%5Bi%5D.pos.add(this.particles%5Bi%5D.dir.mulNew(particleSpeed * tDelta * Math.random()))%3B%0A%0A%09%09%09if ( nowTime - this.particles%5Bi%5D.cameAlive > 1000 ) %7B%0A%09%09%09%09this.particles.splice(i%2C 1)%3B%0A%09%09%09%09forceChange %3D true%3B%0A%09%09%09%09continue%3B%0A%09%09%09%7D%0A%09%09%7D%0A%0A%09%09%2F%2F %3D%3D%0A%09%09%2F%2F drawing%0A%09%09%2F%2F %3D%3D%0A%0A%09%09%2F%2F Reposition the canvas area for IE quirks because it does not understand position%3A fixed%0A%09%09if ( isIEQuirks ) %7B%0A%09%09%09this.gameContainer.style.left %3D%0A%09%09%09%09this.canvas.style.left %3D document.documentElement.scrollLeft %2B "px"%3B%0A%09%09%09this.gameContainer.style.top %3D%0A%09%09%09%09this.canvas.style.top %3D document.documentElement.scrollTop %2B "px"%3B%0A%0A%09%09%09this.navigation.style.right %3D "10px"%3B%0A%09%09%09this.navigation.style.top%0A%09%09%09%09%3D document.documentElement.scrollTop %2B document.body.clientHeight - this.navigation.clientHeight - 10 %2B "px"%3B%0A%09%09%7D%0A%0A%09%09%2F%2F clear%0A%09%09if ( forceChange %7C%7C this.bullets.length !%3D 0 %7C%7C this.particles.length !%3D 0 %7C%7C ! this.pos.is(this.lastPos) %7C%7C this.vel.len() > 0 ) %7B%0A%09%09%09this.ctx.clear()%3B%0A%0A%09%09%09%2F%2F draw player%0A%09%09%09this.ctx.drawPlayer()%3B%0A%0A%09%09%09%2F%2F draw flames%0A%09%09%09if ( drawFlame )%0A%09%09%09%09this.ctx.drawFlames(that.flame)%3B%0A%0A%09%09%09%2F%2F draw bullets%0A%09%09%09if (this.bullets.length) %7B%0A%09%09%09%09this.ctx.drawBullets(this.bullets)%3B%0A%09%09%09%7D%0A%0A%09%09%09%2F%2F draw particles%0A%09%09%09if (this.particles.length) %7B%0A%09%09%09%09this.ctx.drawParticles(this.particles)%3B%0A%09%09%09%7D%0A%09%09%7D%0A%09%09this.lastPos %3D this.pos%3B%0A%09%09forceChange %3D false%3B%0A%09%7D%3B%0A%0A%09%2F%2F Start timer%0A%09var updateFunc %3D function() %7B%0A%09%09%2F%2Ftry %7B%0A%09%09%09that.update.call(that)%3B%0A%09%09%2F*%7D%0A%09%09catch (e) %7B%0A%09%09%09clearInterval(interval)%3B%0A%09%09%09throw e%3B%0A%09%09%7D*%2F%0A%09%7D%3B%0A%09var interval %3D setInterval(updateFunc%2C 1000 %2F FPS)%3B%0A%0A%09function destroy() %7B%0A%09%09clearInterval(interval)%3B%0A%09%09removeEvent(document%2C 'keydown'%2C eventKeydown)%3B%0A%09%09removeEvent(document%2C 'keypress'%2C eventKeypress)%3B%0A%09%09removeEvent(document%2C 'keyup'%2C eventKeyup)%3B%0A%09%09removeEvent(window%2C 'resize'%2C eventResize)%3B%0A%09%09isRunning %3D false%3B%0A%09%09removeStylesheet("ASTEROIDSYEAHSTYLES")%3B%0A%09%09removeClass(document.body%2C 'ASTEROIDSYEAH')%3B%0A%09%09if ( this.highscores )%0A%09%09%09this.highscores.hide()%3B%0A%09%09this.gameContainer.parentNode.removeChild(this.gameContainer)%3B%0A%09%7D%3B%0A%7D%0A%0Aif ( ! window.ASTEROIDSPLAYERS )%0A%09window.ASTEROIDSPLAYERS %3D %5B%5D%3B%0A%0Aif ( window.ActiveXObject %26%26 ! document.createElement('canvas').getContext ) %7B%0A%09try %7B%0A%09%09var xamlScript %3D document.createElement('script')%3B%0A%09%09xamlScript.setAttribute('type'%2C 'text%2Fxaml')%3B%0A%09%09xamlScript.textContent %3D '<%3Fxml version%3D"1.0"%3F><Canvas xmlns%3D"http%3A%2F%2Fschemas.microsoft.com%2Fclient%2F2007"><%2FCanvas>'%3B%0A%09%09document.getElementsByTagName('head')%5B0%5D.appendChild(xamlScript)%3B%0A%09%7D catch ( e ) %7B%7D%0A%0A%09var script %3D document.createElement("script")%3B%0A%09script.setAttribute('type'%2C 'text%2Fjavascript')%3B%0A%09script.onreadystatechange %3D function() %7B%0A%09%09if ( script.readyState %3D%3D 'loaded' %7C%7C script.readyState %3D%3D 'complete' ) %7B%0A%09%09%09if ( typeof G_vmlCanvasManager !%3D "undefined" )%0A%09%09%09%09window.ASTEROIDSPLAYERS%5Bwindow.ASTEROIDSPLAYERS.length%5D %3D new Asteroids()%3B%0A%09%09%7D%0A%09%7D%3B%0A%09script.src %3D "http%3A%2F%2Ferkie.github.com%2Fexcanvas.js"%3B%0A%09document.getElementsByTagName('head')%5B0%5D.appendChild(script)%3B%0A%7D%0Aelse window.ASTEROIDSPLAYERS%5Bwindow.ASTEROIDSPLAYERS.length%5D %3D new Asteroids()%3B%0A%0Avar trackingFrame %3D document.createElement('iframe')%3B%0AtrackingFrame.src %3D 'http%3A%2F%2Ferkie.github.com%2Ftracking.html'%3B%0AtrackingFrame.frameborder %3D '0'%3B%0AtrackingFrame.style.position %3D 'absolute'%3B%0AtrackingFrame.style.top %3D "-1000px"%3B%0AtrackingFrame.style.height %3D "0px"%3B%0AtrackingFrame.style.width %3D "0px"%3B%0A%0Adocument.getElementsByTagName('body')%5B0%5D.appendChild(trackingFrame)%3B%0A%0A%7D)()%3B%7D)()%3B
